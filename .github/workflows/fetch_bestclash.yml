name: 自动抓取 BestClash proxies.yaml

on:
  schedule:
    - cron: "0 * * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fetch:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: 抓取 proxies.yaml（安全模式）
        run: |
          mkdir -p data

          TMP_FILE=$(mktemp)

          if curl -fsSL \
            "https://raw.githubusercontent.com/PuddinCat/BestClash/refs/heads/main/proxies.yaml" \
            -o "$TMP_FILE"; then
              mv "$TMP_FILE" data/proxies.yaml
              echo "抓取成功，已更新文件"
          else
              echo "抓取失败，保留旧文件"
              rm -f "$TMP_FILE"
          fi

      - name: 提交更新
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add data/proxies.yaml
          git commit -m "自动同步 BestClash proxies.yaml" || echo "内容无变化"
          git push
